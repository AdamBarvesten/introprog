%!TEX encoding = UTF-8 Unicode

%!TEX root = ../compendium.tex

\Lab{\LabWeekFIVE}

\begin{Goals}
\item Kunna använda vektorer.
\item Kunna använda SHUFFLE-algoritmen för kortblandning.
\item Kunna räkna frekvenser.
\end{Goals}

\begin{Preparations}
\item Läs igenom så att du förstår SHUFFLE-algoritmen.
\end{Preparations}

\subsection{Bakgrund}

Denna labb handlar om kortblandning. Att blanda kort så att varje möjlig permutation är lika sannolik är icke-trivialt; en osystematiskt blandning leder till en skev fördelning. Förutsatt att det finns en bra slumpgenerator, går det att blanda en kortlek genom att lägga alla kort i en hög och sedan ta ett slumpvist kort från högen och lägga det överst i leken, tills alla kort flyttats från högen till leken. Enligt denna princip fungerar den s.k. Fisher-Yates-algoritmen, ibland även kallad en Knuth-shuffle, här endast kallad SHUFFLE.

%Ett bra sätt att blanda en kortlek på, förutsatt att man har en bra slumpgenerator, är att lägga alla kort i en hög och sedan ta ett slumpvist kort från högen och lägga det överst i leken, tills alla kort ligger i leken. Ungefär på detta sätt fungerar den s.k. Fisher-Yates-algoritmen, ibland även kallad en Knuth-shuffle, här endast kallad SHUFFLE.

\begin{algorithm}[H]
 \SetKwInOut{Input}{Indata}
 \Input{Array $xs$ som ska blandas}
 $len \leftarrow$ antalet element i $xs$ \\
 \For{$i \leftarrow (len - 1)$ \KwTo $0$}{
  $r \leftarrow$ slumptal mellan $0$ och $i$ \\
  $temp \leftarrow xs(i)$ \\
  $xs(i) \leftarrow xs(r)$ \\
  $xs(r) \leftarrow temp$ \\
 }
\end{algorithm}

\subsection{Obligatoriska uppgifter}

\Task 

\Subtask Implementera metoden \code{shuffle} i klassen \code{CardDeck}. Följ algoritmen noga, och använd \code{cards.length} för att få fram längden på kortleken. 

\Subtask Kör \code{TestingDeck} för att testa att blandningen är jämnt fördelad. \code{TestingDeck} blandar en kortlek med tre kort och räknar hur ofta olika permutationer dyker upp. Du bör få en utskrift med sex ($3!$) ungefär lika långa staplar.

\Task Fyll i de ofärdiga delarna av klassen \code{CardDeck}.

\Subtask Skriv kod för att skapa en array innehållande en 52-korts standardlek. Använd case-klasserna i \code{Cards}. Importera antingen \code{UnicodeSuits} eller \code{LetterSuits} om det första inte fungerar. Tänk på att en \code{for}/\code{yield}-sats inte nödvändigtvis ger en \code{Array}, men att alla samlingar kan omvandlas till en sådan med \code{toArray}.

\Subtask Kör \code{CardDeck} och kontrollera så att alla kort ser ut att finnas med.

\Task Använd den färdiga \code{CardDeck}-klassen för att ta fram sannolikheterna för att kortkombinationerna ``royal flush'', ``straight flush'' ``straight'' eller ``flush'' dyker upp bland 5 kort dragna från en blandad kortlek. Simulera detta genom att upprepade gånger blanda kortleken, dra 5 kort och registrera vilka kombinationer som uppstått.

\Subtask Implementera funktionen \code{test} i \code{PokerProbability}. Använd de färdiga funktionerna \code{Hand.drawFrom} och \code{testHand} för att dra och klassificera en hand frånd en kortlek. Lagra frekvenserna i en muterbar \code{Map} (\code{collection.mutable.Map} finns redan importerad).

\Subtask Kör \code{PokerProbability}. Du bör få ungefär \\
\begin{tabular}{ll}
Royal flush    & 0.000154\% \\
Straight flush & 0.00139\%  \\
Flush          & 0.197\%    \\
Straight       & 0.39\%     \\
High card      & 99.41\%
\end{tabular}

% Bilder på respektive korthand med förklarande bildtext för dem som inte vet? 

\subsection{Frivilliga extrauppgifter}

\Task Implementera metoden \code{tally} i klassen \code{Hand} så att simuleringen även kan registrera kortkombinationerna fyrtal, kåk, triss, tvåpar och par. Kör sedan \code{PokerProbability} igen.
